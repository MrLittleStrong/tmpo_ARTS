# 美团iOS工程zsource命令背后的那些事儿

### Links

[美团 iOS 工程 zsource 命令背后的那些事儿](https://tech.meituan.com/2019/08/08/the-things-behind-the-ios-project-zsource-command.html)

### Notes

记录一下知识点：

1. 为了提高整体工程构建速度，对App的组件进行了二进制化。提供了cocoapods-binary的插件来支持本地工程二进制化。集成开发时，除了自己正在开发的组件，其他的组件都以二进制的形式存在。
2. 但是调试时如果在二进制的代码中崩溃，就只能看到堆栈和汇编代码。
3. 美团 App 的组件化方案也提供了将一个组件从二进制切换到源码的机制。美团工程的开发者能够使用一系列配置和命令来切换组件的源码和二进制状态，但每次切换都需要重新执行 pod install。单次pod install时间需要一分钟。
4. xcode编译debug版本的二进制过程中，在二进制的__debug_str Section中存储了二进制对应的源码文件地址。当我们在Xcode打断点进行调试的时候，Xcode会根据二进制中这个字段存储的源码文件地址，打开对应的源码文件，并在UI上展示。
5. 可以用dwarfdump来解析二进制中DWARF格式的命令行工具，发现是用AT_name和AT_comp_dir字段来进行存储的。

实现思路：

- 首先，我们需要确定大部分美团使用的组件二进制的编译目录是相同的。这样就方便我们在本地某个路径下统一管理下载的源码文件。

- 接下来，我们通过 `dwarfdump` 这个命令获取源码文件应该在的路径，然后通过给 CocoaPods 增加命令，将源码文件下载并放置在对应的路径中。